$(function() {
    if ((window.location.hostname !== "localhost") && (window.location.hostname !== "127.0.0.1")) {
        document.title = document.title+" : "+window.location.hostname;
    }

    RED.init({
        apiRootUrl: ""
    });
    
    // Initialize the unit-node toolbar
    RED.unitNodeToolbar.init();
    
    callTripletsApi();
    callDoxigenFunctionApi();

    function callTripletsApi() {
        console.log("Calling triplets API endpoint...");
        
        // Add a timestamp to prevent caching
        var apiUrl = "/api/load_triplets?t=" + new Date().getTime();
        
        $.ajax({
            url: apiUrl,
            method: "GET",
            cache: false,
            success: function(data) {
                console.log("Triplets API call successful:", data);
                
                // Store the data for later use if needed
                window.tripletsData = data;
                
                // Dispatch an event that other components can listen for
                $(document).trigger('triplets-data-loaded', [data]);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error("Error making triplets API call:", textStatus, errorThrown);
                console.error("Status code:", jqXHR.status);
                
                // Log more detailed error information
                if (jqXHR.responseText) {
                    console.error("Response text:", jqXHR.responseText);
                }
            }
        });
    }
    
    function callDoxigenFunctionApi() {
        console.log("Calling doxigen API endpoint...");
        
        // Add a timestamp to prevent caching
        var apiUrl = "/api/load_doxigen?t=" + new Date().getTime();
        
        $.ajax({
            url: apiUrl,
            method: "GET",
            cache: false,
            success: function(data) {
                console.log("Doxigen API call successful:", data);
                
                // Store the data for later use if needed
                window.doxigenData = data;
                
                // Dispatch an event that other components can listen for
                $(document).trigger('doxigen-data-loaded', [data]);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error("Error making doxigen API call:", textStatus, errorThrown);
                console.error("Status code:", jqXHR.status);
                
                // Log more detailed error information
                if (jqXHR.responseText) {
                    console.error("Response text:", jqXHR.responseText);
                }
            }
        });
    }
});
